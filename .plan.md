# Plan: Implement CSS `max-width` Support

## Goal
Enable `max-width` CSS property support for block-level elements. The implementation will support fixed units (`px`, `pt`) only, ignoring percentages for now.

## Context
Currently, `BlockLayoutEngine` calculates the width of a block solely based on the parent's available width minus margins. It does not respect explicit width constraints. This task adds the `max-width` constraint.

## Impact Analysis
*   **Data Model:** `ComputedStyle` needs a new property.
*   **Parsing:** `CssStyleComputer` needs to extract and parse the value.
*   **Layout:** `BlockLayoutEngine` needs to clamp the calculated width.

## Task List

### 1. Data Model Updates
*   [x] **Update `ComputedStyle`**: Add `public float? MaxWidthPt { get; set; }`.
    *   *File:* `src/Html2x.LayoutEngine/Models/ComputedStyle.cs`

### 2. CSS Parsing Logic
*   [x] **Update `CssStyleComputer`**: Implement logic to parse `max-width`.
    *   Use `ICssValueConverter.TryGetLengthPt` (or similar existing helper).
    *   Only accept non-negative values.
    *   Ignore values with unsupported units (e.g., `%`).
    *   *File:* `src/Html2x.LayoutEngine/Style/CssStyleComputer.cs`

### 3. Layout Engine Logic
*   [x] **Update `BlockLayoutEngine`**: Modify `LayoutBlock` to respect `MaxWidthPt`.
    *   Calculate `availableWidth` as usual (parent width - margins).
    *   If `MaxWidthPt` is present and less than `availableWidth`, use it as the `width`.
    *   *File:* `src/Html2x.LayoutEngine/Box/BlockLayoutEngine.cs`
    *   *Sketch:*
        ```csharp
        // Existing:
        var width = Math.Max(0, contentWidth - margin.Left - margin.Right);

        // Proposed Change:
        var availableWidth = Math.Max(0, contentWidth - margin.Left - margin.Right);
        var maxWidth = s.MaxWidthPt; // New nullable property

        var width = maxWidth.HasValue && maxWidth.Value < availableWidth
            ? maxWidth.Value
            : availableWidth;
        ```

### 4. Testing
*   [x] **Unit Tests (`CssStyleComputer`)**:
    *   Test parsing valid `max-width: 100px`.
    *   Test parsing valid `max-width: 50pt`.
    *   Test ignoring `max-width: 50%`.
    *   Test ignoring `max-width: -10px`.
*   [x] **Unit Tests (`BlockLayoutEngine`)**:
    *   Test that a block shrinks when `max-width` < available width.
    *   Test that a block stays at available width when `max-width` > available width.
*   [x] **Visual Verification**:
    *   Create `src/Tests/Html2x.TestConsole/html/max-width.html`.
    *   Run `Html2x.TestConsole` and inspect the PDF/Logs.

## Verification Strategy
*   **Automated:** Run `dotnet test` for the specific test classes.
*   **Manual:** Check diagnostics output (Layout Snapshot) to confirm the `Width` property of the fragment is constrained.
